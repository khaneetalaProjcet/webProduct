import{P as Me,T as P}from"./trade-DFdgY8pn.js";import{T as me}from"./TimerIcon-B6-Ohnjg.js";import{_ as Fe,r as n,p as fe,e as Ne,q as X,w as ye,f as Re,c as De,l as a,k as o,g as be,x as _e,y as Ee,j as c,o as Y,a as l,z as w,m as r,C as E,n as xe}from"./index-N7xqvKBL.js";import{x as we}from"./persian-tools.esm-CBI2Czng.js";const $e={class:"goldbox-section buy me-2"},qe={class:"live-price-box"},Ae={class:"fade-badge"},Oe={class:"d-flex justify-center align-center order-2"},Je={class:"price-in-word"},Ke={class:"goldbox-section"},He={class:"wallet-box"},Qe={class:"d-flex justify-space-between py-2 px-4 my-1"},Xe={class:"mb-0"},Ye={class:"d-flex justify-space-between py-2 px-4 my-1"},Ze={class:"mb-0"},el={class:"my-2"},ll={class:"goldbox-section sell me-2"},tl={class:"live-price-box"},al={class:"fade-badge"},sl={class:"d-flex justify-center align-center order-2"},ol={class:"price-in-word"},nl={class:"goldbox-section"},il={class:"wallet-box sell"},ul={class:"d-flex justify-space-between py-2 px-4 my-1"},rl={class:"mb-0"},dl={class:"d-flex justify-space-between py-2 px-4 my-1"},cl={class:"mb-0"},vl={class:"my-2"},pl={class:"trade-history pa-md-3"},gl={class:"d-flex flex-column flex-md-row justify-space-between"},ml={class:"d-flex justify-start justify-md-end w-100 mt-3"},fl={class:""},yl={class:""},bl={class:""},_l={class:""},xl={class:"buyModal-content py-10"},wl={class:"wallet-badge my-2"},Pl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},hl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},Wl={class:"d-flex justify-space-evenly align-center w-100 my-2"},Vl={class:"d-flex"},Il={class:"d-flex justify-space-around my-2"},Tl={class:"buyModal-content py-10"},kl={class:"wallet-badge my-2"},Cl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},Sl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},jl={class:"d-flex justify-space-evenly align-center w-100 my-2"},Bl={class:"d-flex"},Ul={class:"d-flex justify-space-around my-2"},Gl={__name:"GoldBoxView",setup(Ll){const Z=Ee(),$=n(""),L=n(null),S=n(!1),j=n(!1),ee=n(!1),f=n(""),le=n(""),d=n(!1),q=n(!1),h=n(!1),W=n(!1),g=n(!1),z=n(null),v=n({sellPrice:"",buyPrice:"",change:""}),V=n(30),I=n(!1),te=n(),ae=n(),se=n([{title:"تاریخ",key:"date"},{title:"روش ثبت",key:"tradeType"},{title:"زمان",key:"time"},{title:"وزن طلا(گرم)",key:"goldWeight"},{title:"قیمت نهایی",key:"totalPrice"},{title:"قیمت طلا در لحظه",key:"goldPrice"},{title:"وضعیت",key:"status"}]),Pe=n([{text:"همه",value:""},{text:"موفق",value:"success"},{text:"ناموفق",value:"failed"},{text:"نامشخص",value:"pending"}]);let M=n(null);const A=n({invoiceId:"",paymentUrl:""}),u=n({goldprice:"",goldWeight:""}),i=n({goldPrice:"",goldWeight:""}),T=n({invoiceId:"",isFromWallet:"",balance:0}),k=n({invoiceId:"",isFromWallet:"",balance:0,goldWeight:0}),B=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),U=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),O=n({status:""}),J=n({}),he=[t=>!!t||"مقدار ورودی نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,3})?$/.test(t)||"فقط عدد مجاز است و حداکثر 3 رقم اعشار"],y=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),We=fe(()=>{if(u.value.goldprice&&u.value.goldprice!=""){const t=u.value.goldprice.toString().replace(/,/g,""),e=parseInt(t,10);return e<1?"کمتر از یک تومان":we(Math.floor(e))+" تومان"}return""}),Ve=fe(()=>{if(i.value.goldPrice&&i.value.goldPrice!=""){const t=i.value.goldPrice.toString().replace(/,/g,""),e=parseInt(t,10);return e<1?"کمتر از یک تومان":we(Math.floor(e))+" تومان"}return""}),oe=async()=>{try{ee.value=!0;const t=await Me.GoldPrice();return v.value.buyPrice=t.buyPrice,v.value.sellPrice=t.sellPrice,v.value.change=t.change,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{ee.value=!1}},F=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),ne=t=>t.replace(/,/g,""),Ie=t=>{const e=t.target.selectionStart,m=u.value.goldprice.length,_=ne(u.value.goldprice).replace(/[^0-9]/g,""),x=parseInt(_||0);u.value.goldWeight=(x/v.value.buyPrice).toFixed(3);const b=F(x);u.value.goldprice=b,xe(()=>{const p=b.length-m;t.target.setSelectionRange(e+p,e+p)})},Te=()=>{u.value.goldWeight=u.value.goldWeight.replace(/[^0-9.]/g,""),console.log(u.value.goldWeight);const t=u.value.goldWeight.split(".");t.length>1&&(u.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(u.value.goldWeight=t[0]+"."+t[1].slice(0,3)),u.value.goldprice=parseInt(u.value.goldWeight*v.value.buyPrice);const e=parseInt(u.value.goldWeight*v.value.buyPrice);u.value.goldprice=F(e)},ke=t=>{const e=t.target.selectionStart,m=i.value.goldPrice.length,_=ne(i.value.goldPrice).replace(/[^0-9]/g,""),x=parseInt(_||0);i.value.goldWeight=(x/v.value.sellPrice).toFixed(3);const b=F(x);i.value.goldPrice=b,xe(()=>{const p=b.length-m;t.target.setSelectionRange(e+p,e+p)})},Ce=()=>{i.value.goldWeight=i.value.goldWeight.replace(/[^0-9.]/g,"");const t=i.value.goldWeight.split(".");t.length>1&&(i.value.goldWeight=t[0]+"."+t.slice(1).join("")),t.length>1&&t[1].length>2&&(i.value.goldWeight=t[0]+"."+t[1].slice(0,3)),i.value.goldPrice=parseInt(i.value.goldWeight*v.value.sellPrice);const e=parseInt(i.value.goldWeight*v.value.sellPrice);i.value.goldPrice=F(e)},ie=()=>{g.value=!g.value},Se=[t=>!!t||"مقدار ورودی نمی‌تواند خالی باشد",t=>/^\d+(\.\d{1,3})?$/.test(t)||"فقط عدد مجاز است و حداکثر 3 رقم اعشار"],je=async()=>{try{S.value=!0,B.value.type="buy",B.value.totalPrice=u.value.goldprice,B.value.goldWeight=u.value.goldWeight,B.value.goldPrice=v.value.buyPrice;const t=await P.createInvoice(B.value);return T.value.invoiceId=t.transactionId,T.value.balance=t.wallet.balance,h.value=!0,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{S.value=!1}},ue=async t=>{try{S.value=!0,t=="wallet"?T.value.isFromWallet=!0:T.value.isFromWallet=!1;const e=await P.complateTransaction(T.value);return e.isFromWallet==!0?(h.value=!1,X.replace("/")):(A.value.paymentUrl=e.paymentUrl,A.value.invoiceId=e.invoiceId,window.location.href=A.value.paymentUrl),e}catch(e){f.value=e.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{S.value=!1,H()}},Be=async()=>{try{j.value=!0,U.value.type="sell",U.value.totalPrice=i.value.goldPrice,U.value.goldWeight=i.value.goldWeight,U.value.goldPrice=v.value.sellPrice;const t=await P.createSellInvoice(U.value);return k.value.invoiceId=t.transactionId,k.value.balance=t.wallet.balance,k.value.goldWeight=t.wallet.goldWeight,i.value.goldPrice="",i.value.goldPrice="",W.value=!0,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{j.value=!1}},Ue=async()=>{try{j.value=!0,k.value.fee=1;const t=await P.complateSellTransaction(k.value);return W.value=!1,le.value="طلای شما با موفقیت به فروش رسید",q.value=!0,setTimeout(()=>{q.value=!1},5e3),t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{j.value=!1,K()}},Ge=t=>{O.value.status=t.value,K(),H()},K=async()=>{try{I.value=!0;const t=await P.GoldBoxSellTransactions(O.value);return te.value=t,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{I.value=!1}},H=async()=>{try{I.value=!0;const t=await P.GoldBoxBuyTransactions(O.value);return ae.value=t,t}catch(t){f.value=t.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{I.value=!1}},Le=async t=>{try{const e=await P.VerifyTransaction(t);return console.log(e),J.value=e,e}catch(e){f.value=e.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}};Ne(()=>{oe(),H(),K(),setInterval(()=>{oe()},3e4),$.value=JSON.parse(localStorage.getItem("user"));const t=n({authority:Z.query.Authority,status:Z.query.Status});t.value.authority&&t.value.status&&(Le(t.value),t.value.status==="OK"?X.push({name:"success",state:J.value}):X.push({name:"failed",state:J.value}))}),ye(h,t=>{t?(V.value=30,re()):G()}),ye(W,t=>{t?(V.value=30,re()):G()});const re=()=>{G(),M=setInterval(()=>{V.value>0?V.value--:(G(),h.value=!1,W.value=!1)},1e3)},G=()=>{M&&(clearInterval(M),M=null)};return Re(()=>{G()}),(t,e)=>{const m=c("v-col"),_=c("v-tab"),x=c("v-tabs"),b=c("v-row"),C=c("v-text-field"),p=c("v-btn"),N=c("v-divider"),Q=c("v-container"),R=c("v-tabs-window-item"),de=c("v-tabs-window"),ze=c("v-combobox"),D=c("v-chip"),ce=c("v-data-table"),ve=c("v-card"),pe=c("v-dialog"),ge=c("v-alert");return Y(),De("div",null,[a(Q,{class:"px-0",fluid:""},{default:o(()=>[a(b,{class:"my-1"},{default:o(()=>[a(m,{cols:"12"},{default:o(()=>e[13]||(e[13]=[l("div",{class:"d-flex flex-column align-center"},[l("h3",{class:"title"},"خرید و فروش طلا")],-1)])),_:1}),a(m,{cols:"12"},{default:o(()=>[a(x,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=s=>L.value=s),"bg-color":"white",class:"tab-header"},{default:o(()=>[a(_,{value:"one"},{default:o(()=>e[14]||(e[14]=[w("خرید")])),_:1}),a(_,{value:"two"},{default:o(()=>e[15]||(e[15]=[w("فروش")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(de,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=s=>L.value=s),class:"my-1"},{default:o(()=>[a(R,{value:"one"},{default:o(()=>[a(Q,null,{default:o(()=>[a(b,null,{default:o(()=>[a(m,{cols:"12",md:"7",class:"pa-0 my-2"},{default:o(()=>[l("div",$e,[l("div",qe,[e[16]||(e[16]=l("span",{class:"live-tag"},"لحظه ای",-1)),e[17]||(e[17]=l("p",null,"قیمت طلای 18 عیار:",-1)),l("p",Ae,r(y(v.value.buyPrice))+" تومان ",1)]),l("div",{class:E(["my-1",{"order-3":g.value,"order-1":!g.value}])},[e[18]||(e[18]=l("span",null,"وزن طلا (گرم)",-1)),a(C,{modelValue:u.value.goldWeight,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.goldWeight=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:Te,rules:Se,class:"transition-field"},null,8,["modelValue"])],2),l("div",Oe,[a(p,{icon:"mdi-swap-horizontal",variant:"text",class:"change-btn",onClick:ie})]),l("div",{class:E(["my-1",{"order-1":g.value,"order-3":!g.value}])},[e[19]||(e[19]=l("span",null,"مبلغ (تومان)",-1)),a(C,{modelValue:u.value.goldprice,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.goldprice=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:Ie,class:"transition-field"},null,8,["modelValue"]),l("p",Je,r(We.value),1)],2)])]),_:1}),a(m,{cols:"12",md:"5",class:"pa-0 my-2"},{default:o(()=>[l("div",Ke,[l("div",He,[e[20]||(e[20]=l("p",null,"موجودی کیف پول :",-1)),l("p",null,r(y($.value.balance))+" تومان",1)]),l("div",Qe,[e[21]||(e[21]=l("p",{class:"mb-0"},"گرم طلا :",-1)),l("p",Xe,r(u.value.goldWeight)+" گرم",1)]),a(N),e[24]||(e[24]=l("div",{class:"d-flex justify-space-between py-2 px-4 my-1"},[l("p",{class:"mb-0"},"کارمزد خرید :"),l("p",{class:"mb-0"},"0٪")],-1)),a(N),l("div",Ye,[e[22]||(e[22]=l("p",{class:"mb-0"},"مبلغ قابل پرداخت :",-1)),l("p",Ze,r(y(u.value.goldprice))+" تومان ",1)]),l("div",el,[a(p,{color:"#00603a",loading:S.value,onClick:je,block:""},{default:o(()=>e[23]||(e[23]=[w("خرید")])),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1}),a(R,{value:"two"},{default:o(()=>[a(Q,null,{default:o(()=>[a(b,null,{default:o(()=>[a(m,{cols:"12",md:"7",class:"pa-0 my-2"},{default:o(()=>[l("div",ll,[l("div",tl,[e[25]||(e[25]=l("span",{class:"live-tag"},"لحظه ای",-1)),e[26]||(e[26]=l("p",null,"قیمت طلای 18 عیار:",-1)),l("p",al,r(y(v.value.buyPrice))+" تومان ",1)]),l("div",{class:E(["my-1",{"order-3":g.value,"order-1":!g.value}])},[e[27]||(e[27]=l("span",null,"وزن طلا (گرم)",-1)),a(C,{modelValue:i.value.goldWeight,"onUpdate:modelValue":e[3]||(e[3]=s=>i.value.goldWeight=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:Ce,rules:he},null,8,["modelValue"])],2),l("div",sl,[a(p,{icon:"mdi-swap-horizontal",variant:"text",class:"change-btn",onClick:ie})]),l("div",{class:E(["my-1",{"order-1":g.value,"order-3":!g.value}])},[e[28]||(e[28]=l("span",null,"مبلغ (تومان)",-1)),a(C,{modelValue:i.value.goldPrice,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value.goldPrice=s),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:ke},null,8,["modelValue"]),l("p",ol,r(Ve.value),1)],2)])]),_:1}),a(m,{cols:"12",md:"5",class:"pa-0 my-2"},{default:o(()=>[l("div",nl,[l("div",il,[e[29]||(e[29]=l("p",null,"موجودی صندوق طلا :",-1)),l("p",null,r($.value.goldWeight)+" گرم",1)]),l("div",ul,[e[30]||(e[30]=l("p",{class:"mb-0"},"گرم طلا :",-1)),l("p",rl,r(i.value.goldWeight)+" گرم",1)]),a(N),e[33]||(e[33]=l("div",{class:"d-flex justify-space-between py-2 px-4 my-1"},[l("p",{class:"mb-0"},"کارمزد فروش :"),l("p",{class:"mb-0"},"1٪")],-1)),a(N),l("div",dl,[e[31]||(e[31]=l("p",{class:"mb-0"},"مبلغ قابل پرداخت :",-1)),l("p",cl,r(y(i.value.goldPrice))+" تومان ",1)]),l("div",vl,[a(p,{color:"#930606",loading:j.value,onClick:Be,block:""},{default:o(()=>e[32]||(e[32]=[w("فروش")])),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[37]||(e[37]=l("h3",{class:"title mt-10"},"تاریخچه تراکنش ها",-1)),l("div",pl,[l("div",gl,[a(x,{modelValue:z.value,"onUpdate:modelValue":e[6]||(e[6]=s=>z.value=s),"bg-color":"white",class:"w-100"},{default:o(()=>[a(_,{value:"one"},{default:o(()=>e[34]||(e[34]=[w("خرید")])),_:1}),a(_,{value:"two"},{default:o(()=>e[35]||(e[35]=[w("فروش")])),_:1})]),_:1},8,["modelValue"]),l("div",ml,[a(ze,{label:"وضعیت پرداخت",items:Pe.value,"item-title":"text","item-value":"value",density:"comfortable",variant:"solo",class:"transaction-filter w-100","onUpdate:modelValue":Ge},null,8,["items"])])]),a(de,{modelValue:z.value,"onUpdate:modelValue":e[7]||(e[7]=s=>z.value=s)},{default:o(()=>[a(R,{value:"one",class:"transaction-box"},{default:o(()=>[e[36]||(e[36]=l("div",{class:"d-flex justify-end"},null,-1)),a(ce,{headers:se.value,items:ae.value,loading:I.value,class:"transaction-table"},{"item.status":o(({item:s})=>[l("div",fl,[a(D,{text:s.status=="completed"?"موفق":s.status=="pending"?"نامشخص":"ناموفق",color:s.status=="completed"?"green":s.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":o(({item:s})=>[l("p",null,r(y(s.goldPrice)),1)]),"item.totalPrice":o(({item:s})=>[l("p",null,r(y(s.totalPrice)),1)]),"item.tradeType":o(({item:s})=>[l("div",yl,[a(D,{text:s.tradeType==0?"آنلاین":s.tradeType==1?"تلفنی":s.tradeType==2?"حضوری":"حواله",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1}),a(R,{value:"two",class:"transaction-box"},{default:o(()=>[a(ce,{headers:se.value,items:te.value,loading:I.value,class:"transaction-table"},{"item.status":o(({item:s})=>[l("div",bl,[a(D,{text:s.status=="completed"?"موفق":s.status=="pending"?"نامشخص":"ناموفق",color:s.status=="completed"?"green":s.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":o(({item:s})=>[l("p",null,r(y(s.goldPrice)),1)]),"item.totalPrice":o(({item:s})=>[l("p",null,r(y(s.totalPrice)),1)]),"item.tradeType":o(({item:s})=>[l("div",_l,[a(D,{text:s.tradeType==0?"آنلاین":s.tradeType==1?"تلفنی":s.tradeType==2?"حضوری":"حواله",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),a(pe,{"max-width":"500",modelValue:h.value,"onUpdate:modelValue":e[10]||(e[10]=s=>h.value=s),class:"trade-modal"},{default:o(()=>[a(ve,{class:"trade-modal"},{default:o(()=>[l("div",xl,[e[42]||(e[42]=l("h3",null,"فاکتور خرید",-1)),l("div",wl,[e[38]||(e[38]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,r(T.value.balance)+" تومان",1)]),l("div",Pl,[e[39]||(e[39]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,r(u.value.goldWeight)+" گرم",1)]),l("div",hl,[e[40]||(e[40]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,r(u.value.goldprice)+" تومان",1)]),l("div",Wl,[e[41]||(e[41]=l("span",{class:"fee"},"کارمزد 0 درصد",-1)),l("div",Vl,[l("span",null,r(V.value),1),a(me)])])]),l("div",Il,[a(p,{text:"پرداخت مستقیم",class:"pay-btn",color:"#9D7E3B",onClick:e[8]||(e[8]=s=>ue("direct"))}),a(p,{text:"پرداخت از کیف پول",class:"pay-btn",color:"#9D7E3B",variant:"outlined",onClick:e[9]||(e[9]=s=>ue("wallet"))})])]),_:1})]),_:1},8,["modelValue"]),a(pe,{"max-width":"500",modelValue:W.value,"onUpdate:modelValue":e[12]||(e[12]=s=>W.value=s)},{default:o(()=>[a(ve,null,{default:o(()=>[l("div",Tl,[e[47]||(e[47]=l("h3",null,"فاکتور فروش",-1)),l("div",kl,[e[43]||(e[43]=l("span",{class:"pe-6"},"موجودی کیف پول",-1)),l("span",null,r(k.value.goldWeight)+" گرم",1)]),l("div",Cl,[e[44]||(e[44]=l("p",{class:"pe-6"},"مقدار طلا",-1)),l("p",null,r(i.value.goldWeight)+" گرم",1)]),l("div",Sl,[e[45]||(e[45]=l("p",{class:"pe-6"},"مبلغ",-1)),l("p",null,r(i.value.goldPrice)+" تومان",1)]),l("div",jl,[e[46]||(e[46]=l("span",{class:"fee"},"کارمزد 1 درصد",-1)),l("div",Bl,[l("span",null,r(V.value),1),a(me)])])]),l("div",Ul,[a(p,{text:"تایید فروش",class:"pay-btn",color:"#9D7E3B",onClick:e[11]||(e[11]=s=>Ue())})])]),_:1})]),_:1},8,["modelValue"]),d.value?(Y(),be(ge,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[w(r(f.value),1)]),_:1})):_e("",!0),q.value?(Y(),be(ge,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:o(()=>[w(r(le.value),1)]),_:1})):_e("",!0)])}}},Rl=Fe(Gl,[["__scopeId","data-v-743f3bb1"]]);export{Rl as default};
