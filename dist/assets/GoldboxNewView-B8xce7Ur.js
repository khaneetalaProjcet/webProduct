import{P as Te}from"./price-C3Qya9aJ.js";import{T as h}from"./trade-09QsTmMH.js";import{_ as ce,o as T,c as J,a as t,r as n,e as Se,j as g,w as ue,f as je,m as a,l as s,g as K,y as re,z as Be,k as c,p as r,B as p}from"./index-BNYmA36R.js";const Le={},Ue={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ge(ve,S){return T(),J("svg",Ue,S[0]||(S[0]=[t("path",{d:"M11.4298 1.5H6.56978C3.74978 1.5 3.53228 4.035 5.05478 5.415L12.9448 12.585C14.4673 13.965 14.2498 16.5 11.4298 16.5H6.56978C3.74978 16.5 3.53228 13.965 5.05478 12.585L12.9448 5.415C14.4673 4.035 14.2498 1.5 11.4298 1.5Z",stroke:"#3C3C3C","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M6 12H12",stroke:"#3C3C3C"},null,-1),t("path",{d:"M13.825 14.9223C12.8356 17.1723 5.57501 16.7973 4.82509 15.6722C3.62088 13.8655 5.1551 11.9479 6.00015 12H12.0001C12.0393 11.9562 14.5422 13.2914 13.825 14.9223Z",fill:"#3C3C3C"},null,-1)]))}const de=ce(Le,[["render",Ge]]),Me={class:"d-md-none live-price-box"},ze={class:"live-price"},Ee={class:"d-flex justify-center"},Fe={class:"price-live-card"},Ne={class:"d-flex justify-space-between my-2"},$e={class:"price-change"},De={class:"d-flex justify-space-between my-2"},He={class:"live-price"},Re={class:"d-flex justify-center"},qe={class:"price-live-card"},Oe={class:"d-flex justify-space-between my-2"},Ze={class:"price-change"},Ae={class:"d-flex justify-space-between my-2"},Ke={key:1,class:"live-price"},Je={class:"trade-history"},Qe={class:"d-flex justify-space-between"},Xe={class:""},Ye={class:""},el={class:""},ll={class:""},tl={class:"buyModal-content py-10"},al={class:"wallet-badge my-2"},sl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},ol={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},nl={class:"d-flex justify-space-evenly align-center w-100 my-2"},il={class:"d-flex"},ul={class:"d-flex justify-space-around my-2"},rl={class:"buyModal-content py-10"},dl={class:"wallet-badge my-2"},cl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},vl={class:"d-flex justify-space-evenly align-center w-100 my-2 k-text"},pl={class:"d-flex justify-space-evenly align-center w-100 my-2"},gl={class:"d-flex"},ml={class:"d-flex justify-space-around my-2"},fl={__name:"GoldboxNewView",setup(ve){const S=Be(),z=n(null),j=n(!1),B=n(!1),R=n(!1),f=n(""),Q=n(""),d=n(!1),q=n(!1),V=n(!1),W=n(!1),E=n(null),v=n({sellPrice:"",buyPrice:"",change:""}),C=n(30),I=n(!1),X=n(),Y=n(),ee=n([{title:"تاریخ",key:"date"},{title:"روش ثبت",key:"fromPhone"},{title:"زمان",key:"time"},{title:"وزن طلا(گرم)",key:"goldWeight"},{title:"قیمت نهایی",key:"totalPrice"},{title:"قیمت طلا در لحظه",key:"goldPrice"},{title:"وضعیت",key:"status"}]),pe=n([{text:"همه",value:""},{text:"موفق",value:"success"},{text:"ناموفق",value:"failed"},{text:"نامشخص",value:"pending"}]);let F=n(null);const ge=n({invoiceId:"",paymentUrl:""}),i=n({goldprice:"",goldWeight:""}),u=n({goldPrice:"",goldWeight:""}),x=n({invoiceId:"",amount:"",isFromWallet:"",balance:0}),w=n({invoiceId:"",amount:"",isFromWallet:"",balance:0,goldWeight:0}),L=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),U=n({type:"",totalPrice:"",goldPrice:"",goldWeight:""}),O=n({status:""}),Z=n({}),me=[l=>!!l||"مقدار نمی‌تواند خالی باشد",l=>/^\d+(\.\d{1,2})?$/.test(l)||"مقدار میتواند تا 2 رقم اعشار باشد "],P=l=>l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),le=async()=>{try{R.value=!0;const l=await Te.GoldPrice();return v.value.buyPrice=l.buyPrice,v.value.sellPrice=l.sellPrice,v.value.change=l.change,l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{R.value=!1}},fe=()=>{i.value.goldprice=i.value.goldprice.replace(/[^0-9]/g,""),i.value.goldWeight=(i.value.goldprice/v.value.buyPrice).toFixed(3)},ye=()=>{i.value.goldWeight=i.value.goldWeight.replace(/[^0-9.]/g,"");const l=i.value.goldWeight.split(".");l.length>1&&(i.value.goldWeight=l[0]+"."+l.slice(1).join("")),l.length>1&&l[1].length>2&&(i.value.goldWeight=l[0]+"."+l[1].slice(0,3)),i.value.goldprice=parseInt(i.value.goldWeight*v.value.buyPrice)},_e=()=>{u.value.goldPrice=u.value.goldPrice.replace(/[^0-9]/g,""),u.value.goldWeight=(u.value.goldPrice/v.value.sellPrice).toFixed(3)},be=()=>{u.value.goldWeight=u.value.goldWeight.replace(/[^0-9.]/g,"");const l=u.value.goldWeight.split(".");l.length>1&&(u.value.goldWeight=l[0]+"."+l.slice(1).join("")),l.length>1&&l[1].length>2&&(u.value.goldWeight=l[0]+"."+l[1].slice(0,3)),u.value.goldPrice=parseInt(u.value.goldWeight*v.value.sellPrice)},xe=[l=>!!l||"مقدار ورودی نمی‌تواند خالی باشد",l=>/^\d+(\.\d{1,3})?$/.test(l)||"فقط عدد مجاز است و حداکثر 3 رقم اعشار"],we=async()=>{try{j.value=!0,L.value.type="buy",L.value.totalPrice=i.value.goldprice,L.value.goldWeight=i.value.goldWeight,L.value.goldPrice=v.value.buyPrice;const l=await h.createInvoice(L.value);return x.value.invoiceId=l.transactionId,x.value.balance=l.wallet.balance,V.value=!0,l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{j.value=!1}},te=async l=>{try{j.value=!0,l=="wallet"?x.value.isFromWallet=!0:x.value.isFromWallet=!1,x.value.amount=i.value.goldprice;const e=await h.complateBehpardakhtTransaction(x.value);if(e.isFromWallet==!0)V.value=!1,g.replace("/");else{const _=e.data,y=document.createElement("form");y.method="POST",y.action="https://bpm.shaparak.ir/pgwchannel/startpay.mellat";const b=document.createElement("input");b.name="RefId",b.value=_,y.appendChild(b),document.body.appendChild(y),y.submit(),document.body.removeChild(y),ge.value.invoiceId=e.invoiceId}return e}catch(e){e.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=e.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{j.value=!1,$(),N()}},Pe=async()=>{try{B.value=!0,U.value.type="sell",U.value.totalPrice=u.value.goldPrice,U.value.goldWeight=u.value.goldWeight,U.value.goldPrice=v.value.sellPrice;const l=await h.createSellInvoice(U.value);return w.value.invoiceId=l.transactionId,w.value.balance=l.wallet.balance,w.value.goldWeight=l.wallet.goldWeight,W.value=!0,l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{B.value=!1}},he=async()=>{try{B.value=!0,w.value.amount=u.value.goldPrice,w.value.fee=1;const l=await h.complateSellTransaction(w.value);return W.value=!1,Q.value="طلای شما با موفقیت به فروش رسید",q.value=!0,setTimeout(()=>{q.value=!1},5e3),l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},5e3)}finally{B.value=!1,$(),N()}},Ve=l=>{O.value.status=l.value,N(),$()},N=async()=>{try{I.value=!0;const l=await h.GoldBoxSellTransactions(O.value);return X.value=l,l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{I.value=!1}},$=async()=>{try{I.value=!0;const l=await h.GoldBoxBuyTransactions(O.value);return Y.value=l,l}catch(l){l.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=l.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}finally{I.value=!1}},We=async l=>{try{const e=await h.VerifyTransaction(l);return Z.value=e,e}catch(e){e.response.status==401&&(localStorage.clear(),g.replace("/Login")),f.value=e.response.data.msg||"خطایی رخ داده است!",d.value=!0,setTimeout(()=>{d.value=!1},1e4)}};Se(()=>{le(),$(),N(),setInterval(()=>{le()},1e3*60*2);const l=n({authority:S.query.Authority,status:S.query.Status});l.value.authority&&l.value.status&&(We(l.value),l.value.status==="OK"?g.push({name:"success",state:Z.value}):g.push({name:"failed",state:Z.value}))}),ue(V,l=>{l?(C.value=30,ae()):G()}),ue(W,l=>{l?(C.value=30,ae()):G()});const ae=()=>{G(),F=setInterval(()=>{C.value>0?C.value--:(G(),V.value=!1,W.value=!1)},1e3)},G=()=>{F&&(clearInterval(F),F=null)};return je(()=>{G()}),(l,e)=>{const _=c("v-tab"),y=c("v-tabs"),b=c("v-text-field"),m=c("v-col"),M=c("v-btn"),D=c("v-row"),k=c("v-tabs-window-item"),Ce=c("v-progress-circular"),se=c("v-tabs-window"),Ie=c("v-card-text"),A=c("v-card"),ke=c("v-combobox"),H=c("v-chip"),oe=c("v-data-table"),ne=c("v-dialog"),ie=c("v-alert");return T(),J("div",null,[e[46]||(e[46]=t("div",{class:"d-flex flex-column align-center"},[t("h3",{class:"title"},"خرید و فروش طلا"),t("p",{class:"subtitle"},"با خیال راحت در خانه طلا خرید و فروش کنید")],-1)),a(A,{class:"trade-card mt-3"},{default:s(()=>[t("div",Me,[e[14]||(e[14]=t("div",null,[t("span",{class:"live-tag"},"live"),t("span",{class:"weight-tag"},"1 گرم")],-1)),t("div",null,[e[13]||(e[13]=t("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),t("span",ze,r(P(v.value.buyPrice))+" تومان",1)])]),a(y,{modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=o=>z.value=o),"bg-color":"white",class:"tab-header"},{default:s(()=>[a(_,{value:"one"},{default:s(()=>e[15]||(e[15]=[p("خرید")])),_:1}),a(_,{value:"two"},{default:s(()=>e[16]||(e[16]=[p("فروش")])),_:1}),a(_,{value:"three"},{default:s(()=>e[17]||(e[17]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(Ie,null,{default:s(()=>[a(se,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=o=>z.value=o)},{default:s(()=>[a(k,{value:"one"},{default:s(()=>[a(D,null,{default:s(()=>[a(m,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(D,null,{default:s(()=>[a(m,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[18]||(e[18]=t("span",null,"وزن طلا (گرم)",-1)),a(b,{modelValue:i.value.goldWeight,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.goldWeight=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:ye,rules:xe},null,8,["modelValue"])]),_:1}),a(m,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[19]||(e[19]=t("span",null,"مبلغ (تومان)",-1)),a(b,{modelValue:i.value.goldprice,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.goldprice=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:fe},null,8,["modelValue"])]),_:1}),a(m,{cols:"12",class:"my-2"},{default:s(()=>[t("div",Ee,[a(M,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:j.value,onClick:we},{default:s(()=>e[20]||(e[20]=[p("خرید")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(m,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[t("div",Fe,[t("div",Ne,[t("span",$e,r(v.value.change)+" %",1),e[21]||(e[21]=t("span",{class:"live-tag"},"live",-1))]),e[23]||(e[23]=t("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),t("div",De,[t("span",He,r(P(v.value.buyPrice))+" تومان",1),e[22]||(e[22]=t("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(k,{value:"two"},{default:s(()=>[a(D,null,{default:s(()=>[a(m,{cols:"12",md:"9",class:"my-2"},{default:s(()=>[a(D,null,{default:s(()=>[a(m,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[24]||(e[24]=t("span",null,"وزن طلا (گرم)",-1)),a(b,{modelValue:u.value.goldWeight,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value.goldWeight=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:be,rules:me},null,8,["modelValue"])]),_:1}),a(m,{cols:"12",md:"6",class:"my-2"},{default:s(()=>[e[25]||(e[25]=t("span",null,"مبلغ (تومان)",-1)),a(b,{modelValue:u.value.goldPrice,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value.goldPrice=o),variant:"outlined",color:"rgba(135, 104, 36, 1)",density:"compact",onInput:_e},null,8,["modelValue"])]),_:1}),a(m,{cols:"12",class:"my-2"},{default:s(()=>[t("div",Re,[a(M,{color:"rgba(135, 104, 36, 1)",class:"trade-btn",loading:B.value,onClick:Pe},{default:s(()=>e[26]||(e[26]=[p("فروش")])),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),a(m,{md:"3",class:"my-2 d-none d-md-flex"},{default:s(()=>[t("div",qe,[t("div",Oe,[t("span",Ze,r(v.value.change)+" %",1),e[27]||(e[27]=t("span",{class:"live-tag"},"live",-1))]),e[29]||(e[29]=t("span",{class:"my-2 live-price-text"},"قیمت لحظه ای طلا 18 عیار",-1)),t("div",Ae,[R.value?(T(),K(Ce,{key:0,size:10,color:"#fff",indeterminate:""})):(T(),J("span",Ke,r(P(v.value.buyPrice))+" تومان",1)),e[28]||(e[28]=t("span",{class:"weight-tag"},"1 گرم",-1))])])]),_:1})]),_:1})]),_:1}),a(k,{value:"three"},{default:s(()=>e[30]||(e[30]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e[47]||(e[47]=t("h3",{class:"title"},"تاریخچه تراکنش ها",-1)),t("div",Je,[t("div",Qe,[a(y,{modelValue:E.value,"onUpdate:modelValue":e[6]||(e[6]=o=>E.value=o),"bg-color":"white"},{default:s(()=>[a(_,{value:"one"},{default:s(()=>e[31]||(e[31]=[p("خرید")])),_:1}),a(_,{value:"two"},{default:s(()=>e[32]||(e[32]=[p("فروش")])),_:1}),a(_,{value:"three"},{default:s(()=>e[33]||(e[33]=[p("انتقال")])),_:1})]),_:1},8,["modelValue"]),a(ke,{label:"وضعیت پرداخت",items:pe.value,"item-title":"text","item-value":"value",density:"comfortable",variant:"solo",class:"transaction-filter","onUpdate:modelValue":Ve},null,8,["items"])]),a(se,{modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=o=>E.value=o)},{default:s(()=>[a(k,{value:"one",class:"transaction-box"},{default:s(()=>[e[34]||(e[34]=t("div",{class:"d-flex justify-end"},null,-1)),a(oe,{headers:ee.value,items:Y.value,loading:I.value,class:"transaction-table"},{"item.status":s(({item:o})=>[t("div",Xe,[a(H,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[t("p",null,r(P(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[t("p",null,r(P(o.totalPrice)),1)]),"item.fromPhone":s(({item:o})=>[t("div",Ye,[a(H,{text:o.fromPhone==!0?"تلفنی":"آنلاین",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1}),a(k,{value:"two",class:"transaction-box"},{default:s(()=>[a(oe,{headers:ee.value,items:X.value,loading:I.value,class:"transaction-table"},{"item.status":s(({item:o})=>[t("div",el,[a(H,{text:o.status=="completed"?"موفق":o.status=="pending"?"نامشخص":"ناموفق",color:o.status=="completed"?"green":o.status=="pending"?"#666666":"red",size:"small"},null,8,["text","color"])])]),"item.goldPrice":s(({item:o})=>[t("p",null,r(P(o.goldPrice)),1)]),"item.totalPrice":s(({item:o})=>[t("p",null,r(P(o.totalPrice)),1)]),"item.fromPhone":s(({item:o})=>[t("div",ll,[a(H,{text:o.fromPhone==!0?"تلفنی":"آنلاین",color:"#78909C",size:"small"},null,8,["text"])])]),_:1},8,["headers","items","loading"])]),_:1}),a(k,{value:"three"},{default:s(()=>e[35]||(e[35]=[p(" به زودی ... ")])),_:1})]),_:1},8,["modelValue"])]),a(ne,{"max-width":"500",modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=o=>V.value=o)},{default:s(()=>[a(A,null,{default:s(()=>[t("div",tl,[e[40]||(e[40]=t("h3",null,"فاکتور خرید",-1)),t("div",al,[e[36]||(e[36]=t("span",{class:"pe-6"},"موجودی کیف پول",-1)),t("span",null,r(x.value.balance)+" تومان",1)]),t("div",sl,[e[37]||(e[37]=t("p",{class:"pe-6"},"مقدار طلا",-1)),t("p",null,r(i.value.goldWeight)+" گرم",1)]),t("div",ol,[e[38]||(e[38]=t("p",{class:"pe-6"},"مبلغ",-1)),t("p",null,r(i.value.goldprice)+" تومان",1)]),t("div",nl,[e[39]||(e[39]=t("span",{class:"fee"},"کارمزد 0 درصد",-1)),t("div",il,[t("span",null,r(C.value),1),a(de)])])]),t("div",ul,[a(M,{text:"پرداخت مستقیم",class:"pay-btn",color:"#9D7E3B",onClick:e[8]||(e[8]=o=>te("direct"))}),a(M,{text:"پرداخت از کیف پول",class:"pay-btn",color:"#9D7E3B",variant:"outlined",onClick:e[9]||(e[9]=o=>te("wallet"))})])]),_:1})]),_:1},8,["modelValue"]),a(ne,{"max-width":"500",modelValue:W.value,"onUpdate:modelValue":e[12]||(e[12]=o=>W.value=o)},{default:s(()=>[a(A,null,{default:s(()=>[t("div",rl,[e[45]||(e[45]=t("h3",null,"فاکتور فروش",-1)),t("div",dl,[e[41]||(e[41]=t("span",{class:"pe-6"},"موجودی کیف پول",-1)),t("span",null,r(w.value.goldWeight)+" گرم",1)]),t("div",cl,[e[42]||(e[42]=t("p",{class:"pe-6"},"مقدار طلا",-1)),t("p",null,r(u.value.goldWeight)+" گرم",1)]),t("div",vl,[e[43]||(e[43]=t("p",{class:"pe-6"},"مبلغ",-1)),t("p",null,r(u.value.goldPrice)+" تومان",1)]),t("div",pl,[e[44]||(e[44]=t("span",{class:"fee"},"کارمزد 1 درصد",-1)),t("div",gl,[t("span",null,r(C.value),1),a(de)])])]),t("div",ml,[a(M,{text:"تایید فروش",class:"pay-btn",color:"#9D7E3B",onClick:e[11]||(e[11]=o=>he())})])]),_:1})]),_:1},8,["modelValue"]),d.value?(T(),K(ie,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(r(f.value),1)]),_:1})):re("",!0),q.value?(T(),K(ie,{key:1,color:"success",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:s(()=>[p(r(Q.value),1)]),_:1})):re("",!0)])}}},xl=ce(fl,[["__scopeId","data-v-a0949773"]]);export{xl as default};
